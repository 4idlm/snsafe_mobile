<!-- 
        Author: Sathish Thangaraj
        Description: Product list for Admin and Customer
-->
<!Doctype html>
<html lang="en">

    <head>
        <title>snsafe home screen</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="asset/materialize-css/css/materialize.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel="stylesheet" href="asset/css/style.css">
        <!--<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">-->
        <link rel="stylesheet" href="asset/bootstrap/css/bootstrap.min.css">
        <!-- data table css -->
        <link rel="stylesheet" href="asset/plugins/jquery-datatable/skin/bootstrap/css/dataTables.bootstrap.css">
        <link rel="stylesheet" href="asset/css/dataTables.responsive.css">
        <link rel="stylesheet" href="asset/css/sweetalert.css">
        <link rel="stylesheet" href="asset/css/fancybox.css">
        <link rel="stylesheet" href="asset/css/lumos.css">
        <style>
            html{
                height: 100vh;
            }
            button#AddProduct, button#Addvideo{
                margin-left: 20%;
                margin-left: 45%;
                margin-top: 10px;
                width: 55px;
                height: 55px;
                font-size: 0px;
                border-radius: 50%;
            }
            .fixed-action-btn{top:70px;}
            div#videoModal {
                background: transparent;
            }
            .fixed-action-btn.horizontal {
                position: relative;
                top: 10px !important;
                right: 0px !important;
                z-index: 0 !important;
            }
            .fixed-action-btn.horizontal ul{
                right:115px !important;
            }
            .btn.btn-primary.active {
                color: blue !important;
                background: #fff !important;
            }
            .product_draft-page table.dataTable tr.child ul li:last-child {
                border-top: 0px !important;
            }.product_draft-page button#EditProductDraft, .product_draft-page button#viewGallery, button#deleteProduct {
                border-radius: 50px !important;
                padding: 7px 7px !important;
                height:27px !important;
                width:27px !important;
            }
            button#EditProductDraft {
                margin-right: 10px !important;
            }.product_draft-page table.dataTable tr.child ul li:last-child span.dtr-data {
                width: 65% !important;
                margin-top: 15px;
            }
            button#deleteProduct {
                position: relative !important;
                top: 8px !important;
            }
            video{    width: 100% !important;
                      height: 100% !important;}
            </style>
        </head>

        <body class="product_draft-page">
        <div class="">
            <div class="col s12 navbar-fixed nav">
                <nav>
                    <div class="nav-wrapper">
                        <ul id="slide-out" class="side-nav">
                            <li>
                                <div class="user-view">
                                    <div class="user-profile">
                                        <img class="circle" src="asset/images/profile.png">
                                        <div class="user-detail">
                                            <h4 class="white-text" id="ses_name">John Doe</h4>
                                            <p class="white-text" id="ses_mail">jonedoe@test.com</p>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <hr>
                            <!-- <li><a href="#!"><i class="material-icons">cloud</i>First Link With Icon</a></li>
                            <li><a href="#!">Second Link</a></li>
                            <li>
                                <div class="divider"></div>
                            </li>
                            <li><a class="subheader">Subheader</a></li>
                            <li><a class="waves-effect" href="#!">Third Link With Waves</a></li> -->
                            <div class="nav-links">
                                <a href="profile.html" class="white-text"><img class="navimg" src="asset/images/user.png" alt=""><span class="navtitle">Profile</span></a>
                                <a href="product.html" class="white-text"><img class="navimg" src="asset/images/product.png" alt=""><span class="navtitle">Product List</span></a>
                                <a href="product_draft.html" class="white-text"><img class="navimg" src="asset/images/product.png" alt=""><span class="navtitle">Product Draft</span></a>
                                <!-- <a href="device.html" class="white-text"><img class="navimg" src="asset/images/device.png" alt=""><span class="navtitle">Devices</span></a> -->
                                <a href="finder.html" class="white-text"><img class="navimg" src="asset/images/device.png" alt=""><span class="navtitle">Lost and Found</span></a>
                                <a href="recycle.html" class="white-text"><img class="navimg" src="asset/images/recycle.png" alt=""><span class="navtitle">Recycle</span></a>
                                <a href="user.html" class="white-text" id="usernav"><img class="navimg" src="asset/images/user.png" alt=""><span class="navtitle">Users</span></a>
                                <a href="orders.html" class="white-text"><img class="navimg" src="asset/images/product.png" alt=""><span class="navtitle">Order(s)</span></a>
                                <a href="shop.html" class="white-text" id="shopnav"><img class="navimg" src="asset/images/product.png" alt=""><span class="navtitle">Shop</span></a>
                                <a href="tagsearch.html" class="white-text"><img class="navimg" src="asset/images/user.png" alt=""><span class="navtitle">Tag Search</span></a>
                            </div>

                            <hr>
                            <div class="nav-links">
                                <a href="" class="white-text"><img class="navimg" src="asset/images/product.png" alt=""><span class="navtitle">Settings</span></a>
                                <a href="#" class="white-text" onClick="return logout();"><img class="navimg" src="asset/images/device.png" alt=""><span class="navtitle">Logout</span></a>
                        </ul>
                        <a href="#" data-activates="slide-out" class="button-collapse"><i class="material-icons">menu</i></a>
                        <div class="header">
                            <h2>Product Draft</h2>
                        </div>
                        <ul id="nav-mobile" class="left hide-on-med-and-down">
                            <li><a href="collapsible.html"><i class="fa fa-cart"></i></a></li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
        <div class="se-pre-con"></div>
        <div class="fixed-action-btn horizontal">
            <a class="btn-floating btn-large btn-primary">
                <i class="large material-icons">remove_red_eye</i>
            </a>
            <ul>

                <li><button class="gallery btn btn-primary active" data-toggle="collapse" data-target="#collapsible"><span class="material-icons">photo_library</span></button></li>&nbsp;&nbsp;
                <li><button class="videos btn btn-primary" data-toggle="collapse" data-target="#collapsible"><span class="material-icons">video_library</span></button></li>
            </ul>
        </div>
        <!--        <div class="btn-group btn-toggle"> 
                    
                    
                </div>-->
        <table id="table" class="table table-bordered table-striped table-hover dataTable" style="width:100%;">
            <thead>
                <tr>
                    <th>S.No</th>
                    <th>Gallery</th>
                    <th>Serial number</th>
                    <th>Keyword</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

        <table id="video_table" class="table table-bordered table-striped table-hover dataTable" style="width:100%;">
            <thead>
                <tr>
                    <th>S.No</th>
                    <th>Play</th>
                    <th>Videos</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <!-- model start-->
        <div class="modal fade in" id="defaultModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form id="productForm"  autocomplete="off">
                        <div class="modal-header">
                            <h4 class="modal-title" id="defaultModalLabel">Add product</h4>
                        </div>
                        <div class="modal-body">
                            <br/>
                            <br/>
                            <!--                    <?php
                                                if ($this->logged_type == "customer") {
                                                    ?>-->
                            <div class="customer">
                                <input type="hidden" value="" id="user_id" name="user_id"/>
                            </div>
                            <!--                        <?php
                                                } else {
                                                    ?>-->
                            <div class="form-group admin">
                                <label class="form-label">User *</label>
                                <div class="form-line">
                                    <select name="user_id" id="user_id" class="form-control show-tick browser-default">
                                        <option>Select user</option>
                                    </select>

                                </div>
                            </div>
                            <!--                        <?php
                                                }
                                                ?>-->
                            <div class="form-group q">
                                <label class="form-label z-index">Product group*</label>
                                <div class="form-line setFocus">
                                    <select name="sel_p_group" id="sel_p_group" class="form-control show-tick browser-default">
                                        <option>Select product group </option>
                                        <option value="new_grp">New group </option>
                                    </select>

                                </div>
                            </div>
                            <div class="form-group  hideme">
                                <div class="form-line focused">
                                    <input type="hidden" value="" id="id" name="id"/> 
                                    <input type="hidden" value="" id="updateV" name="updateV"/>
                                    <input type="text" class="form-control validate" name="productGroup" id="productGroup" placeholder="Enter product group *">
                                    <!--<label class="form-label"><?php echo $this->lang->line('product_group'); ?>&nbsp;*</label>-->
                                </div>
                            </div>
                            <div class="form-group form-float q">
                                <div class="form-line input-field">
                                    <input type="text" class="form-control validate" name="brand" id="brand" >
                                    <label class="form-label">Product brand*</label>
                                </div>
                            </div>
                            <div class="form-group form-float q">
                                <div class="form-line input-field">
                                    <input type="text" class="form-control validate" name="model" id="model" >
                                    <label class="form-label">Product model *</label>
                                </div>
                            </div>
                            <div class="form-group form-float">
                                <div class="form-line input-field">
                                    <input type="text" class="form-control validate"  name="snNumber" id="snNumber">
                                    <label class="form-label">Product serial number *</label>
                                    <p id="userErr"></p>
                                </div>
                            </div>
                            <div class="form-group form-float q">
                                <div class="form-line input-field">
                                    <input type="text" class="form-control validate" id="altModelNo" name="altModelNo" >
                                    <label class="form-label">Alternative model number</label>
                                </div>
                            </div>
                            <div class="form-group form-float">
                                <div class="form-line input-field">
                                    <input type="text" name="description" id="description" class="form-control validate">
                                    <label class="form-label">Description</label>
                                </div>
                            </div>
                            <div class="form-group form-float hide">
                                <div class="form-line input-field">
                                    <input type="text" name="giftdescription" id="gift_description">
                                    <label class="form-label">Gift description</label>
                                </div>
                            </div>
                            <div class="form-group form-float q">
                                <div class='input-group form-line date input-field'>
                                    <input type='text' class="datepicker form-control" id="dateBought" name="dateBought" style="background:transparent !important"/><i class="material-icons" >date_range</i>
                                    <!--                                    <span class="input-group-addon">
                                                                            <span class="glyphicon glyphicon-calendar date_bought"></span>-->

                                    <label class="form-label z-index">Date bought*</label>
                                </div>
                            </div>
                            <div class="form-group form-float q">
                                <div class='input-group form-line date input-field' id="warenty_date">
                                    <input type="text" class="form-control datepicker " id="warrantyExpires" name="warrantyExpires" style="background:transparent !important"/><i class="material-icons" >date_range</i>
                                    <!--                                    <span class="input-group-addon">
                                                                            <span class="glyphicon glyphicon-calendar warranty_date"></span>
                                                                        </span>-->
                                    <label class="form-label z-index">warranty expires</label>
                                </div>
                            </div>
                            <div class="form-group q">
                                <label class="form-label"> Used type</label>
                                <div class="form-line input-field setFocus">
                                    <select name="usedType" id="usedType" class="form-control validate show-tick browser-default">
                                        <option value="">used type</option>
                                        <option value="new">new</option>
                                        <option value="used">used</option>
                                    </select>

                                </div>
                            </div>
                            <div class="form-group form-float q">
                                <div class="form-line input-field">
                                    <input type="text" class="form-control validate" id="buyingPrice" name="buyingPrice" >
                                    <label class="form-label">buying price</label>
                                </div>
                            </div>
                            <div class="form-group form-float q">
                                <div class="form-line input-field">
                                    <input type="text" class="form-control validate" id="whereBought" name="whereBought"/> 
                                    <label class="form-label">Where bought</label>
                                </div>
                            </div>
                            <div class="form-group form-float">
                                <div class="file_input_div ">
                                    <div class="file_input">
                                        <label class="form-label">upload product images</label>&nbsp;<label>
                                            <i class="material-icons icon_upload">photo_library</i>
                                            <input class="none"  name="userFiles[]" id="userFiles" type="file" multiple />
                                        </label>
                                        <span id="UploadImgs"></span>
                                    </div>
                                </div>
                            </div>
                            <br>

                            <div class="form-group form-float q">
                                <div class="file_input_div ">
                                    <div class="file_input">
                                        <label class="form-label">Upload product receipt</label>&nbsp;<label>
                                            <i class="material-icons camera">image</i>
                                            <input class="none"  name="photo" id="photo" type="file"/>
                                        </label>
                                        <span id="UploadImg"></span>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <!--<div class="row clearfix">-->
                            <div class="form-group form-float q">
                                <div class="demo-checkbox">
                                    <input name="secure" type="checkbox" id="secure" class="chk-col-green delAddress" value="true">
                                    <label for="secure"><p>Want to make product private?</p></label>

                                </div>
                            </div>
                            <input type="hidden" name="verify_product"  id="verify_product" value="1">
                        </div>
                        <div class="modal-footer">
                            <button type="submit" id="submitProduct" class="btn btn-success waves-effect"><span class="material-icons">check</span></button>&nbsp;&nbsp;
                            <button type="button"   class="btn btn-danger waves-effect" data-dismiss="modal"><span class="material-icons">clear</span></button>
                        </div>

                    </form>
                </div>
            </div>
        </div>
        <!-- model end-->
        <!--product gallery modal-->
        <div class="modal fade in" id="galleryModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-header">
                    <button type="button"   class="btn btn-danger waves-effect" data-dismiss="modal"><span class="material-icons">clear</span></button>
                </div>


                <div class="modal-body">
                    <span  id="productViewGallery"></span>
                </div>


            </div>
        </div>

        <script type="text/javascript" src="asset/js/jquery-3.2.1.min.js"></script>
        <script type="text/javascript" src="asset/materialize-css/js/materialize.min.js"></script>
        <script type="text/javascript" src="asset/bootstrap/js/bootstrap.min.js"></script>
        <!-- Jquery data table plugin-->
        <script type="text/javascript" src="asset/plugins/jquery-datatable/jquery.dataTables.js"></script>
        <script type="text/javascript" src="asset/plugins/jquery-datatable/skin/bootstrap/js/dataTables.bootstrap.js"></script>
        <script type="text/javascript" src="asset/js/dataTables.responsive.js"></script>
        <script type="text/javascript" src="asset/js/jquery_validation.js"></script>
        <script type="text/javascript" src="asset/js/sweet_alert.min.js"></script>
        <script type="text/javascript" src="asset/js/sweetalert_dev.js"></script>
        <script type="text/javascript" src="asset/js/global.js"></script>
        <script type="text/javascript" src="asset/js/fancybox.js"></script>
        <script type="text/javascript" src="asset/js/lumos.js"></script>

        <script>

                                    $(window).on('load', function () {
                                        // Animate loader off screen
                                        $(".se-pre-con").delay(3000).show().fadeOut("slow");
                                    });
                                    //side nav bar initialization (never remove this)
                                    $(".button-collapse").sideNav();
                                    $('#dateBought').pickadate({
                                        selectMonths: true, // Creates a dropdown to control month
                                        selectYears: 150,
                                        autoclose: true,
                                        //format: 'd-m-Y',
                                        mask: '39-19-9999',
                                        timepicker: false,
                                        format: 'dd-mm-yyyy',
                                        // mask:true,
                                        max: true,
                                        noSpinbtn: true,
                                        scrollMonth: false,
                                        scrollInput: false,
                                        futureDate: false,
                                        onClose: function (date) {
                                            var date1 = $('#dateBought').pickadate().pickadate('picker');
                                            var date = new Date(Date.parse(date1.get()));
                                            console.log(date);
                                            date.setDate(date.getDate() + 1);
                                            var newDate = date.toDateString();
                                            newDate = new Date(Date.parse(newDate));
                                            $('#warrantyExpires').pickadate('picker').set('min', newDate);

                                        },
                                        onSet: function () {
                                            setTimeout(this.close, 0);
                                        }
                                    });
                                    $('#warrantyExpires').pickadate({
//                               
                                        selectMonths: true, // Creates a dropdown to control month
                                        selectYears: 150,
                                        autoclose: true,
                                        //format: 'd-m-Y',
                                        mask: '39-19-9999',
                                        timepicker: false,
                                        format: 'dd-mm-yyyy',
                                        // mask:true,
                                        //min: true,
                                        noSpinbtn: true,
                                        scrollMonth: false,
                                        scrollInput: false,
                                        futureDate: false,
                                        onSet: function () {
                                            setTimeout(this.close, 0);
                                        }
                                    });
                                    /*-------datepicker-----*/
                                    $('.datepicker').pickadate({
                                        selectMonths: true, // Creates a dropdown to control month
                                        selectYears: 200, // Creates a dropdown of 15 years to control year,
                                        futureDate: false,
                                        today: 'Today',
                                        clear: 'Clear',
                                        close: 'Ok',
                                        closeOnSelect: false // Close upon selecting a date,
                                    });

                                    $(document).ready(function () {
                                        $('#video_table_wrapper').hide();
                                        $('select').material_select();
                                        getProductgroup();
                                        getUserData();
                                        getSelectUser();
                                        //Upload product images preview
                                        $('#userFiles').change(function () {
                                            $('#UploadImgs').empty();
                                            imagesPreview(this, '#UploadImgs');
                                        });
                                        //Upload receipt image preview
                                        $('#photo').change(function () {
                                            $('#UploadImg').empty();
                                            imagesPreview(this, '#UploadImg');
                                        });
                                        var table = $('#table').DataTable({
                                            ajax: {
                                                url: 'http://rayi.in/snsafe/dev/mobileapi/product/getProductDraft',
                                                type: 'POST',
                                                dataType: 'json'
                                            },
                                            "columnDefs": [{
                                                    "searchable": false,
                                                    "orderable": false,
                                                    "targets": 0
                                                }],
                                            dom: '<"pull-left"f><"pull-right"l>trip',
                                            responsive: true,
                                            processing: true,
                                            info: false,
                                            lengthChange: false,
                                            // serverSide: true,
                                            "order": [[1, 'asc']]
                                        });



                                        table.on('order.dt search.dt', function () {
                                            table.column(0, {search: 'applied', order: 'applied'}).nodes().each(function (cell, i) {
                                                cell.innerHTML = i + 1;
                                            });
                                        }).draw();
                                        var table2 = $('#video_table').DataTable({
                                            ajax: {
                                                url: 'http://rayi.in/snsafe/dev/mobileapi/product/getProductDraftVideo',
                                                type: 'POST',
                                                dataType: 'json'
                                            },
                                            "columnDefs": [{
                                                    "searchable": false,
                                                    "orderable": false,
                                                    "targets": 0
                                                }],
                                            dom: '<"pull-left"f><"pull-right"l>trip',
                                            responsive: true,
                                            processing: true,
                                            info: false,
                                            lengthChange: false,
                                            // serverSide: true,
                                            "order": [[1, 'asc']]
                                        });
                                        $('#video_table_wrapper').hide();
                                    });

                                    //Add Product from validation
                                    $('#productForm').validate({
                                        rules: {
                                            user_id: {
                                                required: true
                                            },
                                            sel_p_group: {
                                                required: true
                                            },
                                            productGroup: {
                                                required: true
                                            },
                                            brand: {
                                                required: true
                                            },
                                            model: {
                                                required: true
                                            },
                                            snNumber: {
                                                required: true
                                            },
                                            dateBought: {
                                                required: true
                                            },
                                            buyingPrice: {
                                                number: true
                                            }
                                        },
                                        highlight: function (input) {
                                            $(input).parents('.form-line').addClass('error');
                                        },
                                        unhighlight: function (input) {
                                            $(input).parents('.form-line').removeClass('error');
                                        },
                                        errorPlacement: function (error, element) {
                                            $(element).parents('.form-group').append(error);
                                        },
                                        messages: {
                                            user_id: {
                                                required: 'Select user'
                                            },
                                            sel_p_group: {
                                                required: 'Select product group'
                                            },
                                            productGroup: {
                                                required: 'Please enter your product group'
                                            },
                                            brand: {
                                                required: 'Please enter your product brand'
                                            },
                                            model: {
                                                required: 'Please enter your product model'
                                            },
                                            snNumber: {
                                                required: 'Please enter your product serial number'
                                            },
                                            dateBought: {
                                                required: 'Please choose a bought date'
                                            },
                                            buyingPrice: {
                                                number: 'Provide number only'
                                            }
                                        },
                                        submitHandler: function () {

                                            update();

                                        }
                                    });
                                    var imagesPreview = function (input, placeToInsertImagePreview) {
                                        if (input.files) {
                                            var filesAmount = input.files.length;
                                            for (i = 0; i < filesAmount; i++) {
                                                var reader = new FileReader();
                                                var filesize = input.files[i].size;
                                                if (filesize < 5242880) {
                                                    reader.onload = function (event) {
                                                        $($.parseHTML('<img with="40" height="40">')).attr('src', event.target.result).appendTo(placeToInsertImagePreview);
                                                    }
                                                    reader.readAsDataURL(input.files[i]);
                                                } else {
                                                    swal('Image upload', 'File size should not be more than 1 MB', 'error');
                                                }
                                            }
                                        }
                                    };
                                    function update() {

                                        var url = "http://rayi.in/snsafe/dev/Product/productUpdate";
                                        var formData = new FormData($('#productForm')[0]);
                                        $.ajax({
                                            url: url,
                                            type: "POST",
                                            data: formData,
                                            contentType: false,
                                            processData: false,
                                            dataType: "JSON",
                                            beforeSend: function () {
                                                $('#block').show();
                                                $('#submitProduct').prop('disabled', true);
                                            },
                                            success: function (rs)
                                            {
                                                if (rs.status === true) {
                                                    $('#defaultModal').modal('hide');
                                                    $('#submitProduct').prop('disabled', false);
                                                    //ajax_dataTable_reload();
                                                    //table.ajax.reload();
                                                    getProductgroup();
                                                    swal('Product updated successfully', '', 'success');
                                                    window.location.href = "product.html";
                                                }
                                            },
                                            error: function ()
                                            {
                                                swal('Product update', 'Error an update a product', 'error');
                                            },
                                            complete: function () {
                                                $('#block').hide();
                                                $('#submitProduct').prop('disabled', false);
                                            }
                                        });
                                    }
                                    //Edit product
                                    function editDraft(id) {
                                        //        getProductgroup();
                                        $('.hideme').hide();
                                        $('#defaultModalLabel').text('Edit Product');
                                        // $('#user_id,#usedType').selectpicker('refresh');
                                        // var vali = $('#productForm').validate();
                                        // vali.resetForm();
                                        $('#defaultModal').modal('show');
                                        $('#UploadImgs,#UploadImg').empty();
                                        $('#id').val(id);
                                        $('#dateBought').empty();
                                        $('#userErr').empty().html('');
                                        $('#updateV').val('update');
                                        $('#submitProduct').attr("disabled", false);
                                        //        $('#snNumber').prop('readonly', true);
                                        $('#productForm')[0].reset();
                                        $('#user_id option').attr("selected", false);
                                        $(".error").removeClass("error");
                                        $.ajax({
                                            url: "http://rayi.in/snsafe/dev/Product/editProduct/" + id,
                                            type: "GET",
                                            dataType: "JSON",
                                            success: function (data)
                                            {
                                                //                $('#user_id option').attr('disabled', 'disabled');
                                                $('#user_id option[value=' + data[0][0].user_id + ']').prop('selected', true);
                                                //                $('#user_id option[value=' + data[0][0].user_id + ']').attr('disabled', false);
                                                $('#id').val(data[0][0].id);
                                                //                $('#productGroup').val(data[0][0].product_group);
                                                $('#brand').val(data[0][0].brand);
                                                $('#model').val(data[0][0].model);
                                                $('#snNumber').val(data[0][0].sn_number);
                                                $('#altModelNo').val(data[0][0].alt_model_no);
                                                $('#description').val(data[0][0].description);
                                                $('#gift_description').val(data[0][0].gift_description);
                                                // $('#dateBought').val(data[0][0].date_bought);
                                                //$('#warrantyExpires').val(data[0][0].warranty_expires);
                                                $('#usedType').val(data[0][0].used_type);
                                                $('#buyingPrice').val(data[0][0].buying_price);
                                                $('#whereBought').val(data[0][0].where_bought);
                                                $('#product_status').val(data[0][0].missing_status);
                                                $('#sel_p_group option[value="' + data[0][0].product_group + '"]').prop('selected', true);
                                                if (data[0][0].secure === '1') {
                                                    $('#secure').prop('checked', true);
                                                } else {
                                                    $('#secure').prop('checked', false);
                                                }
                                                $('#UploadImg').empty().html('<img alt=" " src="' + 'http://rayi.in/snsafe/dev/' + data[0][0].receipt + '" width=40px height=40 />');
                                                // $('#usedType,#user_id,#sel_p_group').selectpicker('refresh');
                                                $('#UploadImgs').empty();
                                                $.each(data['images'], function (ind, row) {
                                                    $('#UploadImgs').append('<img alt=" " src="' + ' http://rayi.in/snsafe/dev/' + row.img_url + '" width=40px height=40 />')
                                                });
                                                checkInput();
                                                $('label').addClass('active');
                                            },
                                            error: function ()
                                            {
                                                swal('Error', 'Error get data from ajax', 'error');
                                            }
                                        });
                                    }
                                    function update() {

                                        var url = "http://rayi.in/snsafe/dev/Product/productUpdate";
                                        var formData = new FormData($('#productForm')[0]);
                                        $.ajax({
                                            url: url,
                                            type: "POST",
                                            data: formData,
                                            contentType: false,
                                            processData: false,
                                            dataType: "JSON",
                                            beforeSend: function () {
                                                $('#block').show();
                                                $('#submitProduct').prop('disabled', true);
                                            },
                                            success: function (rs)
                                            {
                                                if (rs.status === true) {
                                                    $('#defaultModal').modal('hide');
                                                    $('#submitProduct').prop('disabled', false);
                                                    //ajax_dataTable_reload();
                                                    //table.ajax.reload();
                                                    getProductgroup();
                                                    swal('Product updated successfully', '', 'success');
                                                    //  window.location.href = "product.html";
                                                }
                                            },
                                            error: function ()
                                            {
                                                swal('Product update', 'Error an update a product', 'error');
                                            },
                                            complete: function () {
                                                $('#block').hide();
                                                $('#submitProduct').prop('disabled', false);
                                            }
                                        });
                                    }
                                    function getUserData() {

                                        $.ajax({
                                            url: 'http://rayi.in/snsafe/dev/mobileapi/Mobile/getSession',
                                            type: 'POST',
                                            dataType: 'json',
                                            success: function (rs) {

                                                $('#ses_name').html(rs.username);
                                                $('#ses_mail').html(rs.email);
                                                //alert(rs.id);
                                                var usertype = rs.user_type;
                                                if (usertype === 'customer') {
                                                    // alert("am a customer");
                                                    // alert(rs.id);

                                                    $('.admin').empty();
                                                    $('#user_id').val(rs.id);
                                                    $('#v_user_id').val(rs.id);
                                                    $('#usernav').hide();
                                                    // $('#user_id').prop('type', 'hidden');

                                                } else {
                                                    $('.customer').empty();
                                                    $('#shopnav').hide();
                                                    // alert("am a admin");
                                                }
                                            },
                                            error: function () {
                                                alert("Please login");
                                                window.location.href = "index.html";
                                            }
                                        });
                                    }
                                    function logout() {

                                        $.ajax({
                                            type: "POST",
                                            url: "http://rayi.in/snsafe/dev/mobileapi/Mobile/logout",
                                            dataType: 'json',
                                            complete: function () {
                                                window.location.href = "index.html";
                                            }
                                        });
                                    }
                                    function getSelectUser() {
                                        $('select#user_id').empty().html('<option value="">Select user</option>');
                                        $.ajax({
                                            url: 'http://rayi.in/snsafe/dev/user/getUserList',
                                            type: 'GET',
                                            dataType: 'json',
                                            success: function (rs) {
                                                if (rs.status === true) {
                                                    $.each(rs.data, function (ind, row) {
                                                        $('select#user_id').append('<option value="' + row.id + '">' + row.username + '</option>');
                                                    });
                                                    // $('#user_id').selectpicker('refresh');
                                                }
                                            }
                                        });
                                    }
                                    function getProductgroup() {
                                        $('#sel_p_group').empty().html('<option value="">Select group</option><option value="new_grp">New group</option>');
                                        $.ajax({
                                            url: 'http://rayi.in/snsafe/dev/product/getproductGroup',
                                            type: 'GET',
                                            dataType: 'json',
                                            headers: {
                                                // 'X-Auth-Token': 'c4ceef18-7247-9666-852b-9278fdc21bbc'
                                            },
                                            success: function (rs) {
                                                $.each(rs, function (ind, row) {
                                                    $('#sel_p_group').append('<option value="' + row.id + '">' + row.group_name + '</option>');
                                                });
                                                // $('#sel_p_group').selectpicker('refresh');
                                            }

                                        });
                                    }
                                    $('#sel_p_group').change(function () {
                                        if ($(this).val() === "new_grp") {
                                            $('.hideme').show();
                                            $(this).valid();
                                            $('#productGroup').focus();
                                        } else {
                                            $('.hideme').hide();
                                        }
                                    }).change();
                                    $('.btn-toggle').click(function () {
                                        $(this).find('.btn').toggleClass('active');
                                    });
                                    $('.gallery').click(function () {
                                        $('#table_wrapper').show();
                                        $('#video_table_wrapper').hide();
                                        $('.gallery').addClass('active');
                                        $('.videos').removeClass('active');

                                    });
                                    $('.videos').click(function () {
                                        $('#table_wrapper').hide();
                                        $('#video_table_wrapper').show();
                                        $('.videos').addClass('active');
                                        $('.gallery').removeClass('active');

                                    });
                                    //product Slider gallery 
                                    function viewGallery(id) {
//                                        $('.hidden').empty();
                                        $('#productViewGallery').empty();
                                        $.ajax({
                                            url: "http://rayi.in/snsafe/dev/Product/getGallery/" + id,
                                            type: "GET",
                                            dataType: "JSON",
                                            success: function (data)
                                            {
                                                $.each(data, function (ind, row) {
                                                    $('#productViewGallery').append('<img src="http://rayi.in/snsafe/dev/' + row.img_url + '" width="100%" />');
//                                                    $('#gallery').append('<a class="fancybox" href="' + row.img_url + '" rel="gallery"><img src="' + row.img_url + '" alt="" /></a>');
                                                });
                                                $('#galleryModal').modal('show');
                                            },
                                            error: function ()
                                            {
                                                swal('Error', 'Error get gallery image', 'error');
                                            }
                                        });
                                    }
                                    $(".fancybox").attr('rel', 'gallery')
                                            .fancybox({
                                                padding: 0
                                            });
                                    //Delete  product
                                    function deleteDraft(id)
                                    {

                                        swal({
                                            title: "Delete",
                                            text: "Are you sure want to delete a data",
                                            type: "warning",
                                            showCancelButton: true,
                                            confirmButtonColor: "#DD6B55",
                                            confirmButtonText: "Yes",
                                            cancelButtonText: "No",
                                            closeOnConfirm: false,
                                            closeOnCancel: false
                                        },
                                                function (isConfirm) {
                                                    if (isConfirm) {
                                                        // ajax delete data to database
                                                        $.ajax({
                                                            url: "http://rayi.in/snsafe/dev/product/product_status/" + id,
                                                            type: "POST",
                                                            data: {status: 'deleted'},
                                                            dataType: "JSON",
                                                            success: function (data)
                                                            {
                                                                //if success reload ajax table
                                                                $('#defaultModal').modal('hide');
                                                                //ajax_dataTable_reload();
                                                                //table.ajax.reload();

                                                                swal({
                                                                    title: "deleted successfully!",
                                                                    text: "",
                                                                    type: "success"
                                                                }, function () {
                                                                    window.location.href = "product_draft.html";
                                                                });
                                                            },
                                                            error: function (jqXHR, textStatus, errorThrown)
                                                            {
                                                                swal('delete', 'delete error', 'error');
                                                            }
                                                        });
                                                    } else {
                                                        swal("cancelled", "", "error");
                                                    }
                                                });
                                    }
                                    function playVideo(path) {
                                        $('#productViewGallery').empty();

                                        $('#productViewGallery').append('<video controls><source src="' + path + '" type="video/mp4" media="all and (max-width:480px)" ></video>');
                                        $('#galleryModal').modal('show');

                                    }
                                    $("#galleryModal").on('hidden.bs.modal', function (e) {
                                        $("#productViewGallery source").attr("src", $("#productViewGallery video").attr("src"));
                                    });


        </script>

    </body>
</html>